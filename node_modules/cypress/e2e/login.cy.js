describe('Login de Usuário', () => {
  const base = 'http://localhost:3000';

  beforeEach(() => {
    cy.visit(`${base}/login`);
  });

  it('Deve logar e redirecionar para a área logada (cenário principal)', () => {
    // Espere as chamadas de rede relevantes
    cy.intercept('POST', 'http://localhost:8080/login').as('login');
    cy.intercept('GET', 'http://localhost:8080/animals/available').as('animalsAvailable');

    cy.get('input[name="email"]').type('maria@mail.com');
    cy.get('input[name="password"]').type('12345678');
    cy.get('button[type="submit"]').click();

    // Confirma a resposta do login e o redirecionamento
    cy.wait('@login').its('response.statusCode').should('be.oneOf', [200, 201]);
    cy.url({ timeout: 10000 }).should('include', '/area_logada/animais_disponiveis');

    // Aguarda os dados da página carregarem
    cy.wait('@animalsAvailable');

    // Verifica o título no <h1>
    cy.get('h1', { timeout: 10000 })
      .should('contain.text', 'Animais disponíveis para adoção')
      .and('be.visible');
  });

  it('Não deve logar com senha incorreta (cenário alternativo 1)', () => {
    // A app mostra uma janela de alerta em caso de erro de login
    cy.on('window:alert', (txt) => {
      expect(txt).to.match(/Email ou senha inválidos\./i);
    });

    cy.get('input[name="email"]').type('maria@mail.com');
    cy.get('input[name="password"]').type('senhaerrada');
    cy.get('button[type="submit"]').click();

    // Garante que permaneceu na tela de login
    cy.url().should('include', '/login');
  });

  it('Deve mostrar validação se email não for preenchido (cenário alternativo 2)', () => {
  cy.get('input[name="password"]').type('12345678');
  cy.get('button[type="submit"]').click();

  cy.get('input[name="email"]').then(($el) => {
    const input = $el[0];
      // mensagem própria no DOM
      cy.contains(/obrigatório|campo email/i, { timeout: 5000 })
        .should('be.visible');
      cy.log('Validação via mensagem da aplicação detectada');
    });
  cy.url().should('include', '/login');
  });
});